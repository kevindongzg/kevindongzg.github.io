import{e as i,s as c,r,d as C,j as e,f as z,h as N,v as P,D as a}from"./index-45fbd7c2.js";const Q=10*10,D=13,M="LAYOUT__KEY",ne={w:Q,h:D,x:0,y:0,i:"0",minW:0,minH:D,moved:!1,static:!1,isDraggable:!0,isResizable:!0},U="LOCAL_STORAGE_KEY",te=()=>{let l={};return l=JSON.parse(i(U))||{},l[M]},$=l=>{c(U,JSON.stringify({[M]:l}))},q=l=>new Promise((m,d)=>{const s=new FileReader;s.readAsText(l),s.onload=()=>{try{m(JSON.parse(s.result))}catch(x){d(new Error("Parse json error: "+x.toString()))}},s.onerror=()=>{console.log(s.error),d(s.error.toString())}}),W=(l,m,d)=>{const s="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(m,null,2));l.setAttribute("href",s),l.setAttribute("download",d),l.click()},X=10,Z=({message:l,onConfigChanged:m})=>{const d="dashboardConfig.json",[s,x]=r.useState(i(a.TOKEN)||""),[j,f]=r.useState(i(a.TEAM)||""),[u,S]=r.useState(C(i(a.SEARCH))),[h,A]=r.useState(C(i(a.ONCALL))),[p,y]=r.useState(i(a.ORG)||""),[g,_]=r.useState(i(a.IS_ONLY_MAIN_BRANCH)==="true"),[O,E]=r.useState(parseInt(i(a.COLUMN_COUNT))||1),[T,w]=r.useState(!0),[L,H]=r.useState(!0),[b,v]=r.useState(!0),V=()=>{c(a.ORG,p),c(a.TEAM,j),c(a.SEARCH,N(u)),c(a.TOKEN,s),c(a.ONCALL,N(h)),c(a.IS_ONLY_MAIN_BRANCH,`${g}`),c(a.COLUMN_COUNT,O)},Y=()=>{B()&&(V(),m({org:p,team:j,search:u,token:s,oncall:h,isOnlyMainBranch:g,columnCount:O}))},B=()=>(k(s),R(p),I(h),T&&L&&b),k=n=>{const t=n.length>0;return w(t),t},R=n=>{const t=n.length>0;return H(t),t},I=n=>{const t=n&&n.startDate&&n.names.length>=0;return t?(v(t),t):(v(!0),!0)},J=n=>{if(n.target.files.length>0){const t=n.target.files[0];q(t).then(o=>{x(o.token||"Invalided access token!"),y(o.org||"Invalided organization name!"),f(o.team||""),S(o.search||[]),A(o.oncall),_(o.isOnlyMainBranch||!1),E(o.columnCount||1),$(o.layout||{}),console.log("successfully imported")},o=>{console.error(o)})}},F=()=>{const n=document.getElementById("downloadAnchorElem");W(n,{org:p,team:j,search:u,token:s,oncall:h,isOnlyMainBranch:g,columnCount:O},d)},G=n=>{E(parseInt(n.target.value)||0)},K=()=>JSON.stringify({startDate:"2021-09-15",names:["P","F","Y","L","Z","X","Yu"]},null,2);return e.jsxs("div",{className:"auth",children:[l&&e.jsx("div",{className:"auth__message",children:l}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"* Access Token"}),e.jsxs("div",{children:["make sure your access token can access pipelines you filling.",e.jsx("a",{href:"https://buildkite.com/user/api-access-tokens",target:"_blank",rel:"noreferrer",children:"Generate a Token ..."})]}),e.jsx("input",{type:"password",value:s,onChange:n=>{const t=n.target.value;x(t),k(t)},className:T?"":"REQUIRED",required:!0})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"* Organization Name"}),e.jsx("input",{type:"text",value:p,onChange:n=>{const t=n.target.value;y(t),R(t)},className:L?"":"REQUIRED",required:!0})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"Team Name"}),e.jsx("input",{type:"text",value:j,onChange:n=>{f(n.target.value)}})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"Pipeline Name"}),e.jsx("textarea",{id:"pipelines",placeholder:`Support multiple projects, like :
pipeline-a
pipeline-b
pipeline-c
pipeline-d`,value:u==null?void 0:u.join(`
`),onChange:n=>{S(z(n.target.value||""))}})]})}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("span",{children:"Oncall List"}),e.jsx("textarea",{id:"oncallList",placeholder:K(),value:h&&N(h)||"",onChange:n=>{const t=n.target.value;A(t),P(t)?I(C(t)):v(t.length<=0)},className:b?"":"REQUIRED"})]})}),e.jsxs("div",{className:"auth__message-line",children:[e.jsxs("span",{children:[e.jsx("input",{type:"checkbox",id:"justOnlyMainBranch",checked:g,onChange:()=>_(!g)}),e.jsx("label",{htmlFor:"justOnlyMainBranch",children:"Just only show main/master branch"})]}),e.jsxs("span",{children:[e.jsx("label",{htmlFor:"columnCount",children:"Column count"}),e.jsx("select",{name:"columnCount",value:O,onChange:G,children:Array.from(Array(X+1).keys()).splice(1).map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"operation",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"import",children:"Import config"}),e.jsx("input",{className:"import",onChange:J,type:"file",id:"import",name:"import",multiple:!1})]}),e.jsxs("div",{children:[e.jsx("a",{id:"downloadAnchorElem",style:{display:"none"}}),e.jsx("button",{id:"download",onClick:F,children:"Export config"})]})]}),e.jsx("div",{children:e.jsx("div",{className:"btn",onClick:Y,children:"Go!"})})]})},se=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Z as A,ne as D,D as G,Q as S,se as a,te as g,$ as s};
